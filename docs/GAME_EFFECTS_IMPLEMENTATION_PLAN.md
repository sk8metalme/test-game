# ゲームエフェクト実装計画

## 🎯 フェーズ8: ゲームエフェクト実装

### 📋 実装概要
テトリスゲームに視覚的な魅力を追加するパーティクルエフェクトを実装します。既存のパーティクルシステムを活用して、ゲームイベントに応じた美しいエフェクトを提供します。

### 🎮 実装するエフェクト

#### 1. ライン削除エフェクト
- **目的**: ラインが削除された時の爆発効果
- **視覚効果**: 
  - 爆発パーティクル（黄色、オレンジ、赤）
  - 光の粒子（白、黄色）
  - 煙の効果（グレー、薄いグレー）
- **パラメータ**:
  - パーティクル数: 50-100個
  - 持続時間: 1-2秒
  - 爆発範囲: ライン全体

#### 2. T-Spinエフェクト
- **目的**: T-Spin成功時の特殊な光の効果
- **視覚効果**:
  - 螺旋状の光の粒子（青、紫、白）
  - 回転する光の輪
  - 星型の爆発
- **パラメータ**:
  - パーティクル数: 30-60個
  - 持続時間: 2-3秒
  - 回転効果: 時計回り

#### 3. Perfect Clearエフェクト
- **目的**: Perfect Clear達成時の壮大なクリア効果
- **視覚効果**:
  - 全方向への光の爆発（虹色）
  - 上昇する光の柱
  - 祝福の粒子（金色、白）
- **パラメータ**:
  - パーティクル数: 100-200個
  - 持続時間: 3-5秒
  - 爆発範囲: 画面全体

#### 4. レベルアップエフェクト
- **目的**: レベルアップ時の祝福の効果
- **視覚効果**:
  - 上昇する光の粒子（金色、白）
  - 祝福の星（金色）
  - 光の雨
- **パラメータ**:
  - パーティクル数: 40-80個
  - 持続時間: 2-4秒
  - 上昇方向: 画面下部から上部へ

#### 5. ゲームオーバーエフェクト
- **目的**: ゲームオーバー時の悲しい効果
- **視覚効果**:
  - 下降する暗い粒子（グレー、黒）
  - 消えていく光（薄い色）
  - 悲しみの煙
- **パラメータ**:
  - パーティクル数: 60-120個
  - 持続時間: 3-6秒
  - 下降方向: 画面上部から下部へ

### 🏗️ アーキテクチャ設計

```
GameEffects (Application Layer)
├── LineClearEffect (Use Case)
├── TSpinEffect (Use Case)
├── PerfectClearEffect (Use Case)
├── LevelUpEffect (Use Case)
├── GameOverEffect (Use Case)
└── EffectManager (Use Case)
```

### 🔧 実装ステップ

#### ステップ1: 基盤設計
- [ ] GameEffectsクラスの設計
- [ ] エフェクト管理システムの設計
- [ ] ゲームイベントとの連携設計

#### ステップ2: ライン削除エフェクト実装
- [ ] LineClearEffectクラスの実装
- [ ] 爆発パーティクルの設定
- [ ] 光の粒子の設定
- [ ] 煙の効果の設定

#### ステップ3: T-Spinエフェクト実装
- [ ] TSpinEffectクラスの実装
- [ ] 螺旋状パーティクルの設定
- [ ] 回転効果の実装
- [ ] 星型爆発の設定

#### ステップ4: Perfect Clearエフェクト実装
- [ ] PerfectClearEffectクラスの実装
- [ ] 全方向爆発の設定
- [ ] 上昇光柱の実装
- [ ] 祝福粒子の設定

#### ステップ5: レベルアップエフェクト実装
- [ ] LevelUpEffectクラスの実装
- [ ] 上昇粒子の設定
- [ ] 祝福の星の実装
- [ ] 光の雨の設定

#### ステップ6: ゲームオーバーエフェクト実装
- [ ] GameOverEffectクラスの実装
- [ ] 下降粒子の設定
- [ ] 消えていく光の実装
- [ ] 悲しみの煙の設定

#### ステップ7: エフェクト管理システム実装
- [ ] EffectManagerクラスの実装
- [ ] エフェクトの統合管理
- [ ] ゲームイベントとの連携
- [ ] パフォーマンス最適化

#### ステップ8: 統合テストと最適化
- [ ] 全エフェクトの統合テスト
- [ ] パフォーマンステスト
- [ ] ゲームイベント連携テスト
- [ ] 最終的なドキュメント更新

### 📊 成功指標
- **パフォーマンス**: 60FPS維持（エフェクト実行中）
- **メモリ使用量**: エフェクト実行時も100MB以下
- **テストカバレッジ**: 95%以上
- **コード品質**: ESLintエラー0件
- **視覚的品質**: 美しく印象的なエフェクト

### 🎨 エフェクト設定パラメータ

#### 共通パラメータ
```javascript
{
  duration: number,        // 持続時間（ミリ秒）
  particleCount: number,   // パーティクル数
  intensity: number,       // 強度（0.0-1.0）
  scale: number,          // スケール倍率
  colors: string[],       // 色の配列
  position: {x, y},       // 発生位置
  direction: {x, y},      // 方向ベクトル
  speed: number,          // 速度
  gravity: number,        // 重力
  friction: number        // 摩擦
}
```

#### エフェクト固有パラメータ
```javascript
// ライン削除エフェクト
{
  lineHeight: number,     // ラインの高さ
  explosionRadius: number, // 爆発半径
  smokeIntensity: number   // 煙の強度
}

// T-Spinエフェクト
{
  rotationSpeed: number,   // 回転速度
  spiralRadius: number,    // 螺旋半径
  starCount: number        // 星の数
}

// Perfect Clearエフェクト
{
  explosionCount: number,  // 爆発数
  lightPillarHeight: number, // 光柱の高さ
  blessingIntensity: number  // 祝福の強度
}
```

### 🔗 ゲームイベントとの連携

#### イベントタイプ
- `line-clear`: ライン削除
- `t-spin`: T-Spin成功
- `perfect-clear`: Perfect Clear達成
- `level-up`: レベルアップ
- `game-over`: ゲームオーバー

#### 連携方法
```javascript
// ゲームイベントの監視
gameEngine.addEventListener('line-clear', (event) => {
  effectManager.playEffect('line-clear', event.data);
});

// エフェクトの実行
effectManager.playEffect('t-spin', {
  position: {x: 400, y: 300},
  intensity: 1.0
});
```

### 🚀 実装優先順位
1. **ライン削除エフェクト** (最重要)
2. **T-Spinエフェクト** (高優先度)
3. **Perfect Clearエフェクト** (中優先度)
4. **レベルアップエフェクト** (中優先度)
5. **ゲームオーバーエフェクト** (低優先度)

### 📝 注意事項
- 既存のパーティクルシステムとの完全な互換性を保つ
- パフォーマンスを最優先に考慮
- エフェクトの視覚的品質を重視
- ゲームイベントとの連携を確実に実装
- テスト駆動開発（TDD）で品質を保証
